 Bootstrap: docker
From: nvidia/cuda:11.8.0-cudnn8-runtime-ubuntu22.04

%environment
    export HF_HOME=/opt/app/cache
    export TRANSFORMERS_CACHE=/opt/app/cache
    export PYTHONUNBUFFERED=1

%post
    apt-get update && apt-get install -y --no-install-recommends \
        git wget curl ca-certificates build-essential \
        python3 python3-pip python-is-python3

    pip install --upgrade pip
    pip install torch==2.2.2+cu118 torchvision --index-url https://download.pytorch.org/whl/cu118
    pip install transformers accelerate vllm datasets matplotlib

    # 安装 lm-eval
    cd /opt/app/s1/eval/lm-evaluation-harness
    pip install -e .[math,vllm]

%files
    s1 /opt/app/s1       # 📦 打包整个 s1 项目
    cache /opt/app/cache # 📦 打包模型缓存（可选）

%runscript
    cd /opt/app/s1
    exec "$@"
